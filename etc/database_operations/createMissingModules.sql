

insert into CONTENT(OJB_CONCRETE_CLASS,CONTENT_ID,NAME,CREATION_DATE,PREFIX,KEY_AVAILABILITY_POLICY,VISIBLE,EXECUTION_PATH)
values('net.sourceforge.fenixedu.domain.functionalities.Module','452f211a-fada-102a-b5ba-0013d3b09da0','pt14:Estacionamento',NOW(),'/parkingManager',NULL,'1','/parkingManager/index.do');

insert into AVAILABILITY_POLICY(OJB_CONCRETE_CLASS, EXPRESSION, TARGET_GROUP, KEY_CONTENT) 
select 'net.sourceforge.fenixedu.domain.functionalities.ExpressionGroupAvailability', 'role(PARKING_MANAGER)','role(PARKING_MANAGER)', C.ID_INTERNAL FROM CONTENT C WHERE CONTENT_ID='452f211a-fada-102a-b5ba-0013d3b09da0';

insert into CONTENT(OJB_CONCRETE_CLASS,CONTENT_ID,NAME,CREATION_DATE,PREFIX,KEY_AVAILABILITY_POLICY,VISIBLE,EXECUTION_PATH)
values('net.sourceforge.fenixedu.domain.functionalities.Module','421011e0-fadc-102a-b5ba-0013d3b09da0','pt17:Gestão do WebSite',NOW(),'/webSiteManager',NULL,'1','/webSiteManager/index.do');

insert into AVAILABILITY_POLICY(OJB_CONCRETE_CLASS, EXPRESSION, TARGET_GROUP, KEY_CONTENT) 
select 'net.sourceforge.fenixedu.domain.functionalities.ExpressionGroupAvailability', 'role(WEBSITE_MANAGER)','role(WEBSITE_MANAGER)', C.ID_INTERNAL FROM
CONTENT C WHERE CONTENT_ID='421011e0-fadc-102a-b5ba-0013d3b09da0';

update CONTENT C, AVAILABILITY_POLICY AP set C.KEY_AVAILABILITY_POLICY=AP.ID_INTERNAL WHERE AP.KEY_CONTENT=C.ID_INTERNAL;

select @RootModule:=ROOT_DOMAIN_OBJECT.KEY_ROOT_MODULE from ROOT_DOMAIN_OBJECT;

CREATE TEMPORARY TABLE XPTO(CONTENT_ID VARCHAR(255), NODE_ORDER INTEGER);

insert into XPTO(CONTENT_ID, NODE_ORDER) SELECT '452f211a-fada-102a-b5ba-0013d3b09da0', COUNT(ID_INTERNAL)+1 FROM NODE WHERE KEY_PARENT=@RootModule;
insert into XPTO(CONTENT_ID, NODE_ORDER) SELECT '421011e0-fadc-102a-b5ba-0013d3b09da0', COUNT(ID_INTERNAL)+2 FROM NODE WHERE KEY_PARENT=@RootModule;

insert into NODE(OJB_CONCRETE_CLASS, KEY_PARENT, KEY_CHILD,NODE_ORDER,ASCENDING,VISIBLE) SELECT 'net.sourceforge.fenixedu.domain.contents.ExplicitOrderNode',@RootModule, C.ID_INTERNAL, XPTO.NODE_ORDER, '1', '1' FROM XPTO XPTO, CONTENT C WHERE C.CONTENT_ID=XPTO.CONTENT_ID;

DROP TEMPORARY TABLE XPTO;

