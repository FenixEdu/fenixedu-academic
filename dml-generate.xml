<project>
  <!-- the name of the class that should be created to represent a DomainModel -->
  <property name="fenix.framework.domainModelClass" value="pt.ist.fenixframework.pstm.dml.FenixDomainModel"/>

  <!-- the name of the class that should be used to generate code from the DML -->
  <property name="fenix.framework.codeGenerator" value="pt.ist.fenixframework.pstm.dml.FenixCodeGenerator"/>

  <macrodef name="dml-compile"
            description="Generates the domain model from a source DML Language file">
    <attribute name="dml" description="DML source file" />
    <attribute name="java-sources" description="Directory of domain objects" />
    <attribute name="java-gen" description="Directory of the generated base domain objects" />
    <element name="elements" implicit="true" />
    <sequential>
      <mkdir dir="@{java-gen}" />
      <java classname="dml.DmlCompiler" fork="true">
        <arg value="-d" />
        <arg value="@{java-sources}" />
        <arg value="-db" />
        <arg value="@{java-gen}" />
        <arg value="-domainModelClass" />
        <arg value="${fenix.framework.domainModelClass}" />
        <arg value="-generator" />
        <arg value="${fenix.framework.codeGenerator}" />
        <arg value="@{dml}" />
        <elements />
      </java>
    </sequential>
  </macrodef>

  <macrodef name="post-process-domain"
            description="Post process the domain classes generated by the DML compiler">
    <attribute name="dml" description="DML source file" />
    <attribute name="dir" description="Directory where files reside" />
    <element name="elements" implicit="true" />
    <sequential>
      <java classname="pt.ist.fenixframework.pstm.PostProcessDomainClasses" 
            dir="@{dir}"
            fork="true">
        <arg value="-domainModelClass"/>
        <arg value="${fenix.framework.domainModelClass}"/>
        <arg value="-d"/>
        <arg value="@{dml}"/>
        <elements />
      </java>
    </sequential>
  </macrodef>

</project>
