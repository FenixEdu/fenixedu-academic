<?xml version="1.0" encoding="ISO-8859-1"?>
<project basedir="." default="publishCommitLogs" name="CVS Tools">

    <property environment="env"/>
	<property name="encoding" value="ISO-8859-1"/>	

	<property file="development.properties"/>

    <property name="lib" location="lib" />
	<property name="build.home" location="build"/>
	<property name="build.home.temp" value="${build.home}/temp"/>
	<property name="build.home.temp.classes" value="${build.home.temp}/classes"/>
	<property name="build.home.webinf" value="${build.home}/WEB-INF"/>
	<property name="build.home.webinf.classes" value="${build.home.webinf}/classes"/>


	<target name="publishByParam">
		<antcall target="generateLogs">
			<param name="start" value="${year}/${month}/${day1} 00:00"/>
			<param name="end" value="${year}/${month}/${day2} 00:00"/>
			<param name="page" value="${wiki.page}/${year}-${month}-${day1}"/>
		</antcall>
	</target>

	<target name="publishCommitLogs">
		<tstamp>
			<format property="time.yesterday" pattern="yyyy/MM/dd" offset="-24" unit="hour"/>
		</tstamp>
		<tstamp>
			<format property="time.today" pattern="yyyy/MM/dd" unit="hour"/>
		</tstamp>
		<tstamp>
			<format property="time.yesterday.wiki-format" pattern="yyyy-MM-dd" offset="-24" unit="hour"/>
		</tstamp>

		<antcall target="generateLogs">
			<param name="start" value="${time.yesterday} 00:00"/>
			<param name="end" value="${time.today} 00:00"/>
			<param name="page" value="${wiki.page}/${time.yesterday.wiki-format}"/>
		</antcall>
	</target>

	<target name="generateLogs">
		<cvschangelog
				cvsRoot="${cvs.root}"
				cvsRsh="${cvs.rsh}"
				destfile="${cvs.log.file}"
                start="${start}"
				end="${end}"
				>
			<user displayname="AminMahomedAmirali" userid=""/>
			<user displayname="AndreFernandes" userid=""/>
			<user displayname="AngelaAlmeida" userid="ciapl-angela"/>
			<user displayname="AntonioRitoSilva" userid="ars"/>
			<user displayname="CarlosPereira" userid=""/>
			<user displayname="FranciscoPassos" userid=""/>
			<user displayname="FranciscoPaulo" userid=""/>
			<user displayname="JoaoBrito" userid=""/>
			<user displayname="JoaoCachopo" userid="jcachopo"/>
			<user displayname="JoaoFialho" userid=""/>
			<user displayname="JoaoFigueiredo" userid="jdnf"/>
			<user displayname="JoaoLuz" userid="jpvl"/>
			<user displayname="JoaoMota" userid="ciapl-jacm"/>
			<user displayname="JoaoSa" userid=""/>
			<user displayname="LuisCruz" userid="lepc"/>
			<user displayname="LuisEgidio" userid="lmre"/>
			<user displayname="ManuelPinto" userid=""/>
			<user displayname="PedroSantos" userid=""/>
			<user displayname="RicardoRodrigues" userid="rcro"/>
			<user displayname="RitaCarvalho" userid=""/>
			<user displayname="RitaFerreira" userid=""/>
			<user displayname="RuiLopes" userid=""/>
			<user displayname="shezad" userid="sana"/>
			<user displayname="SusanaFernandes" userid=""/>
			<user displayname="TaniaNunes" userid=""/>
			<user displayname="velouria" userid=""/>
		</cvschangelog>
		<delete file="${cvs.log.output}"/>
		<style in="${cvs.log.file}"
               out="${cvs.log.output}"
               style="${cvs.log.stylesheet}">
          <param name="cvsweb" expression="${cvs.web.address}"/>
        </style>
		<antcall target="publish">
			<param name="page" value="${page}"/>
		</antcall>
	</target>

	<target name="publish"
            description="Publishes to wiki">
		<ant antfile="build_codeGenerator.xml" target="compile"/>
		<java classname="pt.utl.ist.report.WikiPublisher"
				fork="yes"
				failonerror="false"
				maxmemory="512m">
			<arg value="${wiki.host}"/>
			<arg value="${wiki.port}"/>
			<arg value="${page}"/>
			<arg value="${cvs.log.output}"/>
			<arg value="${wiki.username}"/>
			<arg value="${wiki.password}"/>
			<classpath>
				<pathelement path="${build.home.temp.classes}"/>
				<pathelement path="${build.home.webinf.classes}"/>
                <fileset dir="${lib}">
                    <include name="**/*.jar"/>
                </fileset>
			</classpath>
		</java>
    </target>

	<target name="get-production-file-properties-file"
            description="Downloads production properties file">
		<delete file="build.properties"/>
		<java classname="pt.utl.ist.fenix.tools.http.client.WikiClient"
				fork="yes"
				failonerror="false"
				maxmemory="128m">
			<arg value="${wiki.host}"/>
			<arg value="${wiki.port}"/>
			<arg value="${wiki.username}"/>
			<arg value="${wiki.password}"/>
			<arg value="${wiki.property.file.page}"/>
			<arg value="${wiki.property.file.filename}"/>
			<classpath>
                <fileset dir="${lib}">
                    <include name="**/*.jar"/>
                </fileset>
			</classpath>
		</java>
    </target>

	<target name="registerDeploy"
            description="Registers deploy on wiki page">
		<java classname="pt.utl.ist.fenix.tools.http.client.DeployRegister"
				fork="yes"
				failonerror="false"
				maxmemory="128m">
			<arg value="${wiki.host}"/>
			<arg value="${wiki.port}"/>
			<arg value="${wiki.username}"/>
			<arg value="${wiki.password}"/>
			<arg value="${tagName}"/>
			<arg value="${comment}"/>
			<classpath>
                <fileset dir="${lib}">
                    <include name="**/*.jar"/>
                </fileset>
			</classpath>
		</java>
    </target>

</project>
