<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="generate-struts-mapping" name="Generate Struts properties file">

	<property file="build.properties"/>

	<!-- Source code directories -->
	<property name="src" location="src_tools/pt/utl/ist/struts" />

	<!-- Directories for compiled code -->
	<property name="build.home" location="web"/>
	<property name="build.home.webinf" value="${build.home}/WEB-INF"/>
	<property name="build.home.webinf.libs" value="${build.home.webinf}/lib"/>

    <!-- Directories with libraries (JARs) -->
    <property name="lib" location="lib" />

	<path id="class.path.lib.ref">
        <fileset dir="${lib}">
   		    <include name="*.jar"/>
   		</fileset>
		<fileset dir="${build.home.webinf.libs}">
			<include name="*.jar"/>
		</fileset>
	</path>

	<!-- Directories for compiled code -->

	<target name="set-properties-copy" if="institution.project"
			description="Determine properties to use for build properties">
		<property name="build.home" location="build"/>
	</target>

	<target name="set-properties-inplace" unless="institution.project"
			description="Determine properties to use for build properties">
		<property name="build.home" location="web"/>
	</target>

	<target name="set-properties" description="Determine properties to use for build properties"
			depends="set-properties-copy, set-properties-inplace">
		<property name="build.home.webinf" value="${build.home}/WEB-INF" />
		<property name="build.home.webinf.classes" value="${build.home}/WEB-INF/classes" />
	</target>

	<target name="compile-struts-mapping-generator" depends="set-properties">
		<javac destdir="${build.home.webinf.classes}">
			<compilerarg line="-processor pt.ist.fenixWebFramework.services.ServiceAnnotationProcessor,pt.ist.fenixWebFramework.security.accessControl.CheckedAnnotationProcessor" />
			<classpath refid="class.path.lib.ref"/>
			<src path="${src}" />
			<include name="StrutsMappingGenerator.java"/>
		</javac>
	</target>

	<target name="generate-struts-mapping" depends="compile-struts-mapping-generator" description="Generates property file for struts mapping auto-loading ">
		<java classname="pt.utl.ist.struts.StrutsMappingGenerator" classpath="${build.home.webinf.classes}">
			<arg value="${build.home.webinf}/conf" />
			<arg value="${build.home.webinf.classes}/struts-auto-mapping.properties"/>
		</java>
	</target>

</project>
